{"version":3,"sources":["Jogador.js"],"names":["Teclado","require","cc","Class","extends","Component","properties","tiro","Prefab","vidaMaxima","Float","_vidaAtual","_direcao","Vec2","_movimentacao","_controleAnimacao","_canvas","Canvas","_camera","Node","_posicaoArma","_audioTiro","AudioSource","_direcaoMouse","onLoad","getComponent","find","on","atirar","calcularDirecaoMouse","node","sofrerDano","children","UP","update","deltaTime","setDirecao","andarPraFrente","ZERO","estaPressionada","KEY","a","x","d","s","y","w","atualizaAnimacao","mudaAnimacao","estadoAtual","evento","detail","dano","eventoPerdeVida","Event","EventCustom","setUserData","vidaAtual","dispatchEvent","jogoAcabou","event","estado","mag","posicaoMouse","getLocation","convertToNodeSpaceAR","posicaoJogadora","position","direcao","sub","disparo","instantiate","iniciliza","parent","add","play"],"mappings":"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","file":"Jogador.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["let Teclado = require(\"Teclado\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiro : cc.Prefab,\n        vidaMaxima : cc.Float,\n        \n        _vidaAtual : cc.Float,\n        _direcao : cc.Vec2,\n        _movimentacao : cc.Component,\n        _controleAnimacao : cc.Component,\n        _canvas : cc.Canvas,\n        _camera : cc.Node,\n        _posicaoArma : cc.Node,\n        _audioTiro : cc.AudioSource,\n        _direcaoMouse : cc.Vec2,\n    },\n\n\n    onLoad: function () {\n       \n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this._audioTiro = this.getComponent(cc.AudioSource);\n        this._canvas = cc.find(\"Canvas\");\n        this._canvas.on(\"mousedown\", this.atirar, this);\n        this._canvas.on(\"mousemove\", this.calcularDirecaoMouse, this);\n        this._camera = cc.find(\"Camera\");\n        this.node.on(\"SofreDano\", this.sofrerDano, this);\n        this._vidaAtual = this.vidaMaxima;\n        this._posicaoArma = this.node.children[0];\n        this._direcaoMouse = cc.Vec2.UP;\n    },\n\n    update: function (deltaTime) {\n        this._movimentacao.setDirecao(this._direcao);\n        this._movimentacao.andarPraFrente();\n\n        this._direcao = cc.Vec2.ZERO;\n        \n        if(Teclado.estaPressionada(cc.KEY.a)){\n            this._direcao.x -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.d)){\n            this._direcao.x +=1;\n        }\n        \n         if(Teclado.estaPressionada(cc.KEY.s)){\n            this._direcao.y -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.w)){\n            this._direcao.y +=1;\n        }\n        \n        this.atualizaAnimacao();\n    },\n    \n    atualizaAnimacao : function(){\n        this._controleAnimacao.mudaAnimacao(this._direcaoMouse, this.estadoAtual());\n    },\n    \n    sofrerDano: function(evento){\n        this._vidaAtual -= evento.detail.dano;\n        let eventoPerdeVida = new cc.Event.EventCustom(\"JogadoraPerdeuVida\", true);\n        eventoPerdeVida.setUserData({vidaAtual : this._vidaAtual ,  vidaMaxima : this.vidaMaxima});\n        this.node.dispatchEvent(eventoPerdeVida);\n        if(this._vidaAtual <0){\n            let jogoAcabou = new cc.Event.EventCustom(\"JogoAcabou\", true);\n            this.node.dispatchEvent(jogoAcabou);\n        }\n    },\n\n    estadoAtual : function(event){\n        let estado;\n        if(this._direcao.mag() == 0){\n            estado = \"Parado\";\n        }else{\n            estado = \"Andar\";\n        }\n        return estado;\n        \n    },\n\n    calcularDirecaoMouse : function(event){\n        let posicaoMouse = event.getLocation();\n        posicaoMouse = new cc.Vec2(posicaoMouse.x, posicaoMouse.y);\n        posicaoMouse = this._canvas.convertToNodeSpaceAR(posicaoMouse);\n        let posicaoJogadora = this._camera.convertToNodeSpaceAR(this.node.position);\n\n        let direcao = posicaoMouse.sub(posicaoJogadora);\n        this._direcaoMouse = direcao;\n    },\n\n    atirar : function(event){\n        let direcao = this._direcaoMouse;\n        let disparo = cc.instantiate(this.tiro);  \n        disparo.getComponent(\"Tiro\").iniciliza(this.node.parent,\n                                               this._posicaoArma.position.add(this.node.position),\n                                               direcao);\n\n        this._audioTiro.play();\n    },\n    \n    \n    \n    \n    \n    \n    \n\n});\n"]}