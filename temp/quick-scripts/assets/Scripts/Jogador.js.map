{"version":3,"sources":["Jogador.js"],"names":["Teclado","require","cc","Class","extends","Component","properties","tiro","Prefab","vidaMaxima","Float","_vidaAtual","_direcao","Vec2","_movimentacao","_controleAnimacao","_canvas","Canvas","_camera","Node","_posicaoArma","_audioTiro","AudioSource","_direcaoMouse","_eventoAtualizaVida","Event","EventCustom","_jogoAcabou","onLoad","getComponent","find","on","atirar","calcularDirecaoMouse","node","sofrerDano","recuperarVida","children","UP","update","deltaTime","andar","verficarTeclado","atualizaAnimacao","setDirecao","andarPraFrente","ZERO","estaPressionada","KEY","a","x","d","s","y","w","mudaAnimacao","estadoAtual","evento","detail","dano","disparaEventoGlobal","vidaAtual","parseFloat","recuperar","Math","min","informacoes","setUserData","dispatchEvent","event","estado","mag","posicaoMouse","getLocation","convertToNodeSpaceAR","posicaoJogadora","position","direcao","sub","disparo","instantiate","iniciliza","parent","add","play"],"mappings":"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","file":"Jogador.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["let Teclado = require(\"Teclado\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiro : cc.Prefab,\n        vidaMaxima : cc.Float,\n\n        _vidaAtual : cc.Float,\n        _direcao : cc.Vec2,\n        _movimentacao : cc.Component,\n        _controleAnimacao : cc.Component,\n        _canvas : cc.Canvas,\n        _camera : cc.Node,\n        _posicaoArma : cc.Node,\n        _audioTiro : cc.AudioSource,\n        _direcaoMouse : cc.Vec2,\n        _eventoAtualizaVida : cc.Event.EventCustom,\n        _jogoAcabou : cc.Event.EventCustom,\n    },\n\n\n    onLoad: function () {\n\n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this._audioTiro = this.getComponent(cc.AudioSource);\n        this._canvas = cc.find(\"Canvas\");\n        this._canvas.on(\"mousedown\", this.atirar, this);\n        this._canvas.on(\"mousemove\", this.calcularDirecaoMouse, this);\n        this._camera = cc.find(\"Camera\");\n        this.node.on(\"SofreDano\", this.sofrerDano, this);\n        this.node.on(\"RecuperarVida\", this.recuperarVida, this);\n        this._vidaAtual = this.vidaMaxima;\n        this._posicaoArma = this.node.children[0];\n        this._direcaoMouse = cc.Vec2.UP;\n        this._eventoAtualizaVida = new cc.Event.EventCustom(\"JogadoraPerdeuVida\", true);\n        this._jogoAcabou = new cc.Event.EventCustom(\"JogoAcabou\", true);\n    },\n\n    update: function (deltaTime) {\n\n        this.andar();\n        this.verficarTeclado();\n        this.atualizaAnimacao();\n    },\n\n    andar : function(){\n        this._movimentacao.setDirecao(this._direcao);\n        this._movimentacao.andarPraFrente();\n    },\n\n    verficarTeclado : function(){\n        this._direcao = cc.Vec2.ZERO;\n\n        if(Teclado.estaPressionada(cc.KEY.a)){\n            this._direcao.x -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.d)){\n            this._direcao.x +=1;\n        }\n\n        if(Teclado.estaPressionada(cc.KEY.s)){\n            this._direcao.y -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.w)){\n            this._direcao.y +=1;\n        }\n    },\n\n    atualizaAnimacao : function(){\n        this._controleAnimacao.mudaAnimacao(this._direcaoMouse, this.estadoAtual());\n    },\n\n    sofrerDano: function(evento){\n        this._vidaAtual -= evento.detail.dano;\n\n        this.disparaEventoGlobal(this._eventoAtualizaVida, {vidaAtual : this._vidaAtual ,  vidaMaxima : this.vidaMaxima});\n\n        if(this._vidaAtual <0){\n            this.disparaEventoGlobal(this._jogoAcabou);\n        }\n    },\n\n    recuperarVida : function(evento){\n        this._vidaAtual += parseFloat(evento.detail.recuperar);\n        this._vidaAtual = Math.min(this._vidaAtual, this.vidaMaxima);\n\n        this.disparaEventoGlobal(this._eventoAtualizaVida, {vidaAtual : this._vidaAtual ,  vidaMaxima : this.vidaMaxima});\n\n    },\n\n    disparaEventoGlobal : function(evento, informacoes){\n        evento.setUserData(informacoes);\n        this.node.dispatchEvent(evento);\n    },\n\n    estadoAtual : function(event){\n        let estado;\n        if(this._direcao.mag() == 0){\n            estado = \"Parado\";\n        }else{\n            estado = \"Andar\";\n        }\n        return estado;\n    },\n\n    calcularDirecaoMouse : function(event){\n        let posicaoMouse = event.getLocation();\n        posicaoMouse = new cc.Vec2(posicaoMouse.x, posicaoMouse.y);\n        posicaoMouse = this._canvas.convertToNodeSpaceAR(posicaoMouse);\n        let posicaoJogadora = this._camera.convertToNodeSpaceAR(this.node.position);\n\n        let direcao = posicaoMouse.sub(posicaoJogadora);\n        this._direcaoMouse = direcao;\n    },\n\n    atirar : function(event){\n        let direcao = this._direcaoMouse;\n        let disparo = cc.instantiate(this.tiro);  \n        disparo.getComponent(\"Tiro\").iniciliza(this.node.parent,\n                                               this._posicaoArma.position.add(this.node.position),\n                                               direcao);\n\n        this._audioTiro.play();\n    },\n\n\n\n\n\n\n\n\n});\n"]}